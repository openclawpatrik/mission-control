<!doctype html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mission Control</title>
  <style>
    :root{
      --bg:#050912;
      --bg2:#0a1222;
      --panel:#0f1a31cc;
      --line:#28406a;
      --text:#eaf1ff;
      --muted:#9ab0d9;
      --red:#ff5c7a;
      --yellow:#ffcd59;
      --blue:#61b2ff;
      --green:#44d695;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--text);font:14px/1.45 Inter,system-ui,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1200px 500px at 10% 100%, rgba(255,90,120,.15), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(87,159,255,.16), transparent 60%),
        radial-gradient(1100px 600px at 70% 120%, rgba(68,214,149,.12), transparent 60%),
        linear-gradient(180deg,var(--bg),var(--bg2));
      overflow-x:hidden;
    }

    .topbar{position:sticky;top:0;z-index:40;display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#070e1dcf;border-bottom:1px solid var(--line);backdrop-filter:blur(10px)}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(145deg,#243f72,#132747);box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .title{font-weight:800;letter-spacing:.08em}.subtitle{font-size:12px;color:var(--muted)}
    .topstats{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid #345286;background:#0e1c35;color:#d6e5ff;box-shadow:inset 0 0 10px rgba(76,130,220,.12)}

    .app{max-width:1900px;margin:0 auto;padding:12px;display:grid;grid-template-columns:280px minmax(860px,1fr) 320px;gap:12px}
    .panel{border:1px solid var(--line);border-radius:var(--radius);background:var(--panel);box-shadow:0 14px 30px rgba(0,0,0,.35),inset 0 0 60px rgba(64,108,184,.05)}

    .section-h{display:flex;justify-content:space-between;align-items:center;padding:10px 10px 8px;color:#bdd0f3;font-size:12px;text-transform:uppercase;letter-spacing:.12em}

    .side,.feed{padding:8px;min-height:calc(100vh - 90px)}
    .agent{display:flex;gap:10px;align-items:center;background:linear-gradient(180deg,#132543,#0f1d35);border:1px solid #2f4b78;border-radius:12px;padding:8px;margin-bottom:8px}
    .avatar{width:42px;height:42px;border-radius:8px;object-fit:cover;display:block;border:1px solid #4168a8;box-shadow:0 4px 10px rgba(0,0,0,.35);image-rendering:pixelated;background:#dfe4ee;padding:2px}
    .a-meta b{display:block;font-size:13px}
    .a-role{font-size:12px;color:var(--muted)}
    .badge{margin-left:auto;font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid #315288;background:#11213d;color:#d2e2ff;display:flex;align-items:center;gap:5px;font-weight:600}
    .state-working{border-color:#2a7e62;background:#103528;color:#bff5dd}
    .state-active{border-color:#6d5a25;background:#34290f;color:#ffe5aa}
    .state-idle{border-color:#3b5a8e;background:#132a4a;color:#c9dcff}
    .state-review{border-color:#6a4a90;background:#2a1b45;color:#e5d2ff}

    .board-wrap{padding:8px;overflow:auto}
    .board{display:grid;grid-template-columns:repeat(4,minmax(250px,1fr));gap:10px;min-width:1060px}
    .col{border:1px solid #2b4068;border-radius:12px;padding:8px;min-height:550px;background:linear-gradient(180deg,rgba(12,21,38,.88),rgba(10,18,34,.88));position:relative;overflow:hidden}
    .col::after{content:'';position:absolute;inset:auto -40% -45% -40%;height:120px;filter:blur(30px);opacity:.35;pointer-events:none}
    .colhead{display:flex;justify-content:space-between;align-items:center;padding:7px 9px;border-radius:10px;border:1px solid #355489;background:#132748;margin-bottom:8px}
    .coltitle{font-size:12px;text-transform:uppercase;letter-spacing:.08em;font-weight:700}
    .count{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #45689d;background:#18325a;color:#ddecff}

    .col-backlog .colhead{border-color:#7b3a4b;background:linear-gradient(180deg,#331821,#261118)}
    .col-backlog .count{border-color:#8f4358;background:#3a1721;color:#ffc0cc}
    .col-backlog::after{background:radial-gradient(circle,var(--red),transparent 60%)}

    .col-doing .colhead{border-color:#816529;background:linear-gradient(180deg,#342a14,#261d0e)}
    .col-doing .count{border-color:#8b6f2f;background:#3b2d12;color:#ffe3a1}
    .col-doing::after{background:radial-gradient(circle,var(--yellow),transparent 60%)}

    .col-review .colhead{border-color:#3f6ba7;background:linear-gradient(180deg,#142943,#11243a)}
    .col-review .count{border-color:#4477bd;background:#15325a;color:#bfdbff}
    .col-review::after{background:radial-gradient(circle,var(--blue),transparent 60%)}

    .col-done .colhead{border-color:#2c7a60;background:linear-gradient(180deg,#132b22,#10231c)}
    .col-done .count{border-color:#329073;background:#133226;color:#b4f6d8}
    .col-done::after{background:radial-gradient(circle,var(--green),transparent 60%)}

    .card{position:relative;z-index:1;background:linear-gradient(180deg,#142646,#101d36);border:1px solid #35568d;border-radius:12px;padding:10px;margin-bottom:9px;box-shadow:0 6px 14px rgba(0,0,0,.28);transition:.15s}
    .card:hover{transform:translateY(-2px);border-color:#5589d8;box-shadow:0 10px 20px rgba(0,0,0,.35)}
    .card h4{margin:0 0 7px;font-size:13px;line-height:1.35}
    .meta{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:6px}
    .tag{font-size:11px;padding:2px 7px;border-radius:999px;border:1px solid #43689f;background:#17305a;color:#d7e6ff}
    .prio-H{border-color:#8e4359;background:#3a1721;color:#ffc3cf}
    .prio-M{border-color:#8d6f2e;background:#3a2d12;color:#ffe2a0}
    .prio-L{border-color:#2f8a6d;background:#143426;color:#b8f5da}
    .next{font-size:12px;color:#c5d6f5}

    .stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
    .stat{background:linear-gradient(180deg,#142646,#101d36);border:1px solid #35568d;border-radius:12px;padding:8px}
    .stat .k{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
    .stat .v{font-size:20px;font-weight:800;line-height:1.2;margin-top:2px}
    .stat-good{border-color:#2e8d66;background:linear-gradient(180deg,#123324,#0f271d)}
    .stat-good .v{color:#bff6dc}
    .stat-warn{border-color:#9a7a2f;background:linear-gradient(180deg,#352a12,#2a200e)}
    .stat-warn .v{color:#ffe4a1}
    .stat-bad{border-color:#9b4159;background:linear-gradient(180deg,#361722,#2a1118)}
    .stat-bad .v{color:#ffc2cf}
    .feed-item{background:linear-gradient(180deg,#142646,#101d36);border:1px solid #35568d;border-radius:12px;padding:8px;margin-bottom:8px}
    .feed-item b{font-size:12px}.feed-item .muted{font-size:12px;color:var(--muted);margin-top:2px}
    .empty{color:var(--muted);font-size:12px;opacity:.8}

    @media (max-width:1280px){.app{grid-template-columns:1fr}.side,.feed{min-height:auto}}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">üõ∞Ô∏è</div>
      <div><div class="title">MISSION CONTROL</div><div class="subtitle" id="updated">Laddar data‚Ä¶</div></div>
    </div>
    <div class="topstats" id="topstats"></div>
  </header>

  <main class="app">
    <aside class="panel side">
      <div class="section-h"><span>Agents</span><span id="agentCount"></span></div>
      <div id="agents"></div>
    </aside>

    <section class="panel board-wrap"><div class="board" id="board"></div></section>

    <aside class="panel feed">
      <div class="section-h"><span>System Stats</span><span id="statsUpdated"></span></div>
      <div class="stats-grid" id="stats"></div>
      <div class="section-h" style="padding-top:2px"><span>Live Feed</span><span id="feedCount"></span></div>
      <div id="feed"></div>
    </aside>
  </main>

<script>
const AVATAR_VER = 'v4';
const TEAM = [
  { name:'Max Mercer', role:'Orchestrator & priorities', state:'Active', avatar:`./avatars/max-mercer.svg?${AVATAR_VER}` },
  { name:'Nina Sparks', role:'Research & trend radar', state:'Active', avatar:`./avatars/nina-sparks.svg?${AVATAR_VER}` },
  { name:'Leo Byte', role:'Builder & app maker', state:'Idle', avatar:`./avatars/leo-byte.svg?${AVATAR_VER}` },
  { name:'Ivy Shield', role:'QA & risk guardian', state:'Idle', avatar:`./avatars/ivy-shield.svg?${AVATAR_VER}` },
  { name:'Owen Flux', role:'Ops & automation', state:'Active', avatar:`./avatars/owen-flux.svg?${AVATAR_VER}` }
];
const STATE_META = {
  Working: { icon:'üü¢', cls:'state-working', text:'Working' },
  Active: { icon:'‚ö°', cls:'state-active', text:'Active' },
  Idle: { icon:'üåô', cls:'state-idle', text:'Idle' },
  Review: { icon:'üîé', cls:'state-review', text:'Review' }
};
const COLUMNS=[['backlog','Backlog'],['doing','In Progress'],['review','Review'],['done','Done']];
const byId=id=>document.getElementById(id);
const el=(t,c,h)=>{const e=document.createElement(t); if(c)e.className=c; if(h!==undefined)e.innerHTML=h; return e};

// avatars are static SVGs in ./avatars

function renderTopStats(data){
  const b=(data.columns.backlog||[]).length,d=(data.columns.doing||[]).length,r=(data.columns.review||[]).length,dn=(data.columns.done||[]).length;
  const top=byId('topstats'); top.innerHTML='';
  [`Backlog ${b}`,`In Progress ${d}/${data.wip_limit_doing||3}`,`Review ${r}`,`Done ${dn}`,`Agents ${TEAM.length}`]
    .forEach(x=>top.appendChild(el('span','pill',x)));
}

function renderAgents(data){
  const wrap=byId('agents'); wrap.innerHTML='';
  const doing=(data.columns.doing||[]).length;
  TEAM.forEach((a,i)=>{
    const state=(i===0&&doing>0)?'Working':a.state;
    const meta = STATE_META[state] || STATE_META.Active;
    const card=el('div','agent');
    card.innerHTML=`<img class="avatar" src="${a.avatar}" alt="${a.name}" /><div class="a-meta"><b>${a.name}</b><div class="a-role">${a.role}</div></div><span class="badge ${meta.cls}"><span>${meta.icon}</span><span>${meta.text}</span></span>`;
    wrap.appendChild(card);
  });
  byId('agentCount').textContent=TEAM.length;
}
function prioClass(p){return p==='H'?'prio-H':p==='L'?'prio-L':'prio-M'}
function renderCard(t){
  const card=el('article','card');
  const tags=(t.tags||[]).map(x=>`<span class="tag">${x}</span>`).join('');
  card.innerHTML=`<h4>${t.title||'Untitled'}</h4><div class="meta"><span class="tag ${prioClass(t.priority)}">Prio ${t.priority||'M'}</span><span class="tag">${t.owner||'Bob'}</span>${tags}</div><div class="next">${t.next_action||''}</div>`;
  return card;
}
function renderBoard(data){
  const board=byId('board'); board.innerHTML='';
  COLUMNS.forEach(([k,label])=>{
    const col=el('section','col col-'+k),items=data.columns[k]||[];
    col.innerHTML=`<div class="colhead"><div class="coltitle">${label}</div><div class="count">${items.length}</div></div>`;
    if(!items.length) col.appendChild(el('div','empty','Inga kort.'));
    items.forEach(t=>col.appendChild(renderCard(t))); board.appendChild(col);
  });
}
function levelPercent(v){
  if(v===null || v===undefined || Number.isNaN(Number(v))) return '';
  v = Number(v);
  if(v < 60) return 'stat-good';
  if(v < 80) return 'stat-warn';
  return 'stat-bad';
}
function levelTemp(t){
  if(t===null || t===undefined || Number.isNaN(Number(t))) return '';
  t = Number(t);
  if(t < 70) return 'stat-good';
  if(t < 85) return 'stat-warn';
  return 'stat-bad';
}
function levelNet(kbps){
  if(kbps===null || kbps===undefined || Number.isNaN(Number(kbps))) return '';
  kbps = Number(kbps);
  if(kbps < 100) return 'stat-good';
  if(kbps < 1000) return 'stat-warn';
  return 'stat-bad';
}

function renderStats(stats){
  const wrap=byId('stats');
  if(!stats){ wrap.innerHTML='<div class="empty">Ingen systemdata √§nnu.</div>'; return; }
  const cpu = stats.cpu?.used_percent ?? null;
  const ram = stats.ram?.used_percent ?? null;
  const d = stats.disk?.used_percent ?? null;
  const temp = stats.temperature?.cpu_c;
  const thermal = stats.temperature?.thermal_status || '-';
  const rx = stats.network?.rx_kbps;
  const tx = stats.network?.tx_kbps;
  const iface = stats.network?.interface || '-';

  wrap.innerHTML='';
  wrap.appendChild(el('div',`stat ${levelPercent(cpu)}`,`<div class="k">CPU Usage</div><div class="v">${cpu ?? '-'}%</div>`));
  wrap.appendChild(el('div',`stat ${levelPercent(ram)}`,`<div class="k">RAM Usage</div><div class="v">${ram ?? '-'}%</div>`));
  wrap.appendChild(el('div',`stat ${levelPercent(d)}`,`<div class="k">Disk Usage</div><div class="v">${d ?? '-'}%</div><div class="muted">${stats.disk?.used||'-'} / ${stats.disk?.size||'-'}</div>`));
  wrap.appendChild(el('div',`stat ${levelTemp(temp)}`,`<div class="k">Temperature</div><div class="v">${temp ?? 'N/A'}</div><div class="muted">${temp==null?'Thermal: '+thermal:('CPU ¬∞C')}</div>`));
  wrap.appendChild(el('div',`stat ${levelNet(rx)}`,`<div class="k">Network Rx</div><div class="v">${rx ?? '-'} KB/s</div><div class="muted">${iface}</div>`));
  wrap.appendChild(el('div',`stat ${levelNet(tx)}`,`<div class="k">Network Tx</div><div class="v">${tx ?? '-'} KB/s</div><div class="muted">${iface}</div>`));
  byId('statsUpdated').textContent = stats.updated_at ? new Date(stats.updated_at).toLocaleTimeString('sv-SE') : '';
}

function renderFeed(data){
  const events=[];
  (data.columns.doing||[]).forEach(t=>events.push({s:'Working',t:t.title}));
  (data.columns.review||[]).forEach(t=>events.push({s:'Review',t:t.title}));
  (data.columns.done||[]).forEach(t=>events.push({s:'Done',t:t.title}));
  const feed=byId('feed'); feed.innerHTML='';
  if(!events.length) feed.appendChild(el('div','empty','Inga events √§nnu.'));
  events.slice(0,12).forEach(x=>feed.appendChild(el('div','feed-item',`<b>${x.s}</b><div class="muted">${x.t}</div>`)));
  byId('feedCount').textContent=events.length;
}
async function load(){
  try{
    const ts = Date.now();
    const [boardRes, statsRes] = await Promise.all([
      fetch('./KANBAN.json?ts='+ts),
      fetch('./system_stats.json?ts='+ts).catch(()=>null)
    ]);
    const data=await boardRes.json();
    let stats=null;
    if(statsRes && statsRes.ok){ stats = await statsRes.json(); }
    byId('updated').textContent=`Senast uppdaterad: ${new Date().toLocaleString('sv-SE')}`;
    renderTopStats(data); renderAgents(data); renderBoard(data); renderStats(stats); renderFeed(data);
  }catch{ byId('updated').textContent='Kunde inte l√§sa KANBAN.json'; }
}
load(); setInterval(load,30000);
</script>
</body>
</html>
